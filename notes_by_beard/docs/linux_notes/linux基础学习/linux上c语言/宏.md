###### 宏函数的返回值
宏集成了很多语句，其中，最后一个语句的值就是返回值。
例如下面这样：

```c
#define wait_event_interruptible(wq, condition)				\
({									\
	int __ret = 0;							\
	might_sleep();							\
	if (!(condition))						\
		__ret = __wait_event_interruptible(wq, condition);	\
	__ret;								\
})
```

__ret就是这个宏函数的返回值。

这样定义宏函数的时候要注意一个问题，因为最后一个语句未必有返回值，比如最后一个语句是空返回值的函数，这种情况就会导致错误的产生，我们应该尽量避免这样定义宏函数。这样使用有可能导致：
	随机返回一个值，比如栈里面的垃圾数据；
	编译器发出警告；
	导致程序行为异常，可能会崩溃。
###### 结构体内嵌宏
```c
struct i2c_msg {
	__u16 addr;	/* slave address			*/
	__u16 flags;
#define I2C_M_RD		0x0001	/* read data, from slave to master */
					/* I2C_M_RD is guaranteed to be 0x0001! */
#define I2C_M_TEN		0x0010	/* this is a ten bit chip address */
#define I2C_M_RECV_LEN		0x0400	/* length will be first received byte */
#define I2C_M_NO_RD_ACK		0x0800	/* if I2C_FUNC_PROTOCOL_MANGLING */
#define I2C_M_IGNORE_NAK	0x1000	/* if I2C_FUNC_PROTOCOL_MANGLING */
#define I2C_M_REV_DIR_ADDR	0x2000	/* if I2C_FUNC_PROTOCOL_MANGLING */
#define I2C_M_NOSTART		0x4000	/* if I2C_FUNC_NOSTART */
#define I2C_M_STOP		0x8000	/* if I2C_FUNC_PROTOCOL_MANGLING */
	__u16 len;		/* msg length				*/
	__u8 *buf;		/* pointer to msg data			*/
};
```
宏的作用域并不会因为结构体而被限制住，所以在结构体外也是有效的，这样做的好处是，将宏定义与其相关的结构体成员就近防止，开发者能够将二者联想到一起，同时项目迁移的时候也比较方便。

