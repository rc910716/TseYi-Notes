## Task02 【算法】ZFNet

### 1 ZFNet 简介

- 理论来源：Matthew D. Zeiler 和 Rob Fergus 的 Visualizing and Understanding Convolutional Networks 论文，主要介绍 CNN 的每一层的特征学习，并通过可视化进行调整网络，提高精度
- ZFNet 是 2013 年 ImageNet 图像分类竞赛冠军
- ZFNet 的网络结构：在 AlexNet 的基础上进行了修改，将第一层的卷积核变成了 7x7，调整步长为 2，并在之后的卷积层也进行了不同的调整

### 2 方法

&emsp;&emsp; 在正向训练的基础上，通过 Deconvnet 的技巧，包括反池化、ReLU 和反卷积，用于重建可视化图像，相关方法如下：

- 反池化：在正向池化的过程中，记录相应的池化位置，在反池化过程中，按照对应的窗口，重建还原之前的位置
- 反激活：使用 ReLU 激活函数
- 反卷积：使用转置后的卷积核

### 3 卷积可视化

- 第 1 层卷积：找到 9 个卷积核激活最大的数据集中原图前 9 个图片（patch-top9）
- 第 2 层卷积：选出 16 个卷积核，找到能够使得激活最大的图片，每个图片都来自验证集（使用已选出的图片可重构原始输入的像素空间）
- 第 3、4、5 层卷积：所提取的特征逐渐变得高级，与第 2 层的流程相似

**注**：论文中，彩色图表示从原始数据集中找出，并使得特定层激活最大的 9 张图片；灰色图表示将 9 张图片分别喂入网络中，找到特征空间，用反卷积的方法重构原始输入的像素空间，得到的可视化图像

#### 3.1 不变性

&emsp;&emsp; 对原图进行平移、缩放、旋转对网络的不同层提取信息的影响，其中计算变换之后的特征向量和原图的特征向量的欧式距离，观察其影响。

1. 垂直平移、缩放的影响：对网络的底层影响显著（急剧影响），对网络的高层影响较小（线性影响）
2. 旋转：每旋转 90°，存在对称性，网络能够在此期间捕获同样的特征

#### 3.2 网络中不同层的卷积核可视化

&emsp;&emsp; 对卷积核进行步长和尺寸的调整，可发现卷积核失效的变化，将步长从 4 变成 2，将卷积核尺寸从 11x11 变成 7x7，发现卷积核失效减少

#### 3.3 遮挡测试

- 测试目的：使用小方块对图片进行遮挡，测试网络预测结果对遮挡的敏感性。
- 论文中的图像含义：
  1. 灰色图片中的黑框部分：将不经遮挡的图片放入网络中，得到第 5 层激活最大的 feature map，用反卷积的方法重构原始输入的像素空间，得到的可视化图像
  2. 热力图：使用灰色挡板遮挡原图中不同位置，在每次遮挡过程中，记录第 5 层激活最大的 feature map，将所有该位置的 feature map 进行叠加，形成热力图

#### 3.4 局部遮挡的相关性分析

&emsp;&emsp; 测试验证对不同狗的图片遮挡相同位置，对网络模型的影响，通过计算海明距离的求和值进行比较，说明深度学习模型隐式定义了图片中局部位置的相关性。

&emsp;&emsp; 相关性分析的计算公式：

$$
\Delta_l = \sum_{i,j=1, i \neq j}^5 \mathcal{H}(\text{sign}(\epsilon_i^l), \text{sign}(\epsilon_j^l))
$$

其中 $\epsilon_i^l$ 表示第 $i$ 张图片遮挡前后第 $l$ 层 feature map 之差，反映了第 $i$ 张图片遮挡之后对第 $l$ 层网络提取得到 feature 的影响。$\Delta_l$ 反映了在不同图像中遮挡相同位置对模型网络中第 $l$ 层提取得到的 feature map 的影响是不相同的。

### 4 实验：对模型进行修改之后的对比

- 将 6 个卷积模型进行融合，发现比 AlexNet 好很多，有显著提升，达到了 14.8% 的错误率
- 只去掉卷积层，影响不大，只去掉全连接层，影响不大，但同时去除卷积层和全连接层，影响很大
- 增加卷积层中卷积核个数，稍微有些作用，但会产生过拟合
- 调整 3、4、5 层的卷积核个数，效果最好，验证集为 37.5%，验证集为 16.0%
- 使用 ImageNet 的预训练模型进行迁移学习，效果不错
- 在 Caltech-256 数据集中，每个类别仅使用 6 张图片训练模型，能够达到最佳模型的性能
- 在 PASCAL 2012 数据集上，模型效果不好，主要是因为 ImageNet 与该数据集是不一样的
- 分析不同层特尔真对分类的有效性，层数越深，特征越有用

### 5 本章总结

本次任务，主要对 ZFNet 论文进行了讲解，主要包括：

1. Deconvnet 的方法：包括反池化、反激活和反卷积，重点介绍了反池化的技巧
2. 卷积可视化：包括不同层的可视化
3. 局部遮挡敏感性和相关性分析：通过计算海明距离的求和值进行比较，说明深度学习模型隐式定义了图片中局部位置的相关性
4. 对比实验：对模型进行改进，并在不同数据集的泛化分析
